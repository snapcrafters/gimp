name: gimp
version: '2.9.6'
summary: GNU Image Manipulation Program
description: |
  Whether you are a graphic designer, photographer, illustrator, or scientist,
  GIMP provides you with sophisticated tools to get your job done. You can
  further enhance your productivity with GIMP thanks to many customization
  options and 3rd party plugins.

confinement: strict
icon: gimp.png

apps:
  gimp:
    command: desktop-launch env GIMP2_DATADIR="$SNAP/usr/share/gimp/2.0" GIMP2_LOCALEDIR="$SNAP/usr/share/gimp/2.0/locale" GIMP2_SYSCONFDIR="$SNAP/etc/gimp/2.0" GIMP2_PLUGINDIR="$SNAP/usr/lib/gimp/2.0" $SNAP/usr/bin/gimp
    plugs: [gsettings, home, removable-media, unity7, opengl]

parts:
  patches:
    plugin: dump
    source: snap/patches
    prime: [-*]
  gimp:
    after: [patches, desktop-gtk2]
    plugin: autotools
    source: git://git.gnome.org/gimp
    source-tag: 'GIMP_2_9_6'
    prepare: patch -p 1 < $SNAPCRAFT_STAGE/bump_Babl-GEGL_versions.patch
    configflags:
      - '--prefix=/usr'
      - '--sysconfdir=/etc'
      - '--enable-binreloc'
    install: |
      sed -i 's|^\(.*python=\).*|\1/snap/gimp/current/usr/bin/python|' $SNAPCRAFT_PART_INSTALL/usr/lib/gimp/2.0/interpreters/pygimp.interp
    build-packages:
      - gettext
      - gnome-pkg-tools
      - gtk-doc-tools
      - intltool
      - iso-codes
      - libaa1-dev
      - libart-2.0-dev
      - libasound2-dev
      - libatk1.0-dev
      - libbabl-dev
      - libbz2-dev
      - libcurl4-openssl-dev
      - libexif-dev
      - libfreetype6-dev
      - libfontconfig1-dev
      - libgegl-dev
      - libgs-dev
      - libgudev-1.0-dev
      - libice-dev
      - libjasper-dev
      - libjpeg8-dev
      - liblcms2-dev
      - libmng-dev
      - libpng12-dev
      - libpoppler-glib-dev
      - librsvg2-dev
      - libsm-dev
      - libtiff5-dev
      - libwmf-dev
      - libxpm-dev
      - zlib1g-dev
      - patchutils
      - python-dev
      - python-gtk2-dev
      - xsltproc
    stage-packages:
      - libaa1
      - libart-2.0-2
      - libasound2
      - libbabl-0.1-0
      - libbz2-1.0
      - libcurl3
      - libexif12
      - libfreetype6
      - libfontconfig1
      - libgegl-0.3-0
      - libgs9
      - libgudev-1.0-0
      - libice6
      - libjasper1
      - libjpeg8
      - liblcms2-2
      - libmng2
      - libpng12-0
      - librsvg2-2
      - libsm6
      - libtiff5
      - libwmf0.2-7
      - libxpm4
      - zlib1g
      - python
      - python-dev
      - python-gtk2
